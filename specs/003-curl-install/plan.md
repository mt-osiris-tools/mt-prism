# Implementation Plan: Curl-Based Installation

**Branch**: `003-curl-install` | **Date**: 2025-11-21 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-curl-install/spec.md`

## Summary

Add a curl-based one-command installation option for MT-PRISM to reduce installation friction from ~5 manual steps to a single command. The installer will handle platform detection, prerequisite validation, dependency installation, PATH configuration, and `.env` setup automatically, following patterns from rustup, nvm, and pyenv.

## Technical Context

**Language/Version**: Bash 4.0+ (shell script for installer)
**Primary Dependencies**: curl, tar, grep, sed (standard POSIX utilities)
**Storage**: Local filesystem (`~/.mt-prism/` for installation, `install.json` for manifest)
**Testing**: Shell script unit tests (bats or shellspec), integration tests on Docker containers
**Target Platform**: macOS (Intel/ARM), Linux (amd64/arm64), Windows/WSL
**Project Type**: Single (install script + minimal supporting files)
**Performance Goals**: Complete installation in under 30 seconds on modern hardware
**Constraints**: No sudo required (user-local install), no compilation (use pre-built dist/)
**Scale/Scope**: Single install.sh script (~500 lines), minimal infrastructure (GitHub Pages/raw URL)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: Skill-First Architecture

**Status**: ✅ PASS

**Evaluation**: This is a pure infrastructure feature (install script), not a discovery skill. Does not introduce new skills or modify existing skill architecture. Complements the plugin by improving distribution.

### Principle II: Document-Driven Discovery

**Status**: ✅ PASS

**Evaluation**: Not applicable - this is installation infrastructure, not a discovery workflow feature.

### Principle III: Test-First Development

**Status**: ✅ PASS

**Evaluation**: Install script will follow TDD:
- Phase 0: Research install patterns
- Phase 1: Write test scenarios for install script
- Phase 2: Implement install script to pass tests
- Testing: Shell script tests + Docker integration tests

### Principle IV: Iterative Clarification

**Status**: ✅ PASS

**Evaluation**: Not applicable - installation is well-understood domain with established patterns.

### Principle V: Progressive Enhancement

**Status**: ✅ PASS

**Evaluation**: Feature delivers in increments:
1. P1: Basic one-command install (MVP)
2. P2: Auto-config setup (enhancement)
3. P3: Version management (advanced)

### Principle VI: Observable Operations

**Status**: ✅ PASS

**Evaluation**: Install script will provide progress indicators, error messages, and verification output per FR-016, FR-011, FR-020.

### Principle VII: MCP-Based Integration

**Status**: ✅ PASS

**Evaluation**: Not applicable - installation doesn't require MCP services.

### Principle VIII: LLM Provider Abstraction

**Status**: ✅ PASS

**Evaluation**: Not applicable - installation doesn't use LLM providers.

**Overall Gate Status**: ✅ ALL GATES PASS - Proceed to Phase 0

## Project Structure

### Documentation (this feature)

```text
specs/003-curl-install/
├── plan.md              # This file
├── research.md          # Phase 0: Install script patterns research
├── data-model.md        # Phase 1: Installation manifest schema
├── quickstart.md        # Phase 1: Quick install guide
├── contracts/           # Phase 1: Install script interface
│   └── install-api.md   # Install script options and outputs
└── tasks.md             # Phase 2: Generated by /speckit.tasks
```

### Source Code (repository root)

```text
install.sh               # Main installation script (curl target)
scripts/
└── install/
    ├── detect-platform.sh    # Platform detection logic
    ├── verify-prereqs.sh     # Node.js version checking
    ├── download-release.sh   # GitHub release download
    └── configure-env.sh      # .env setup logic

tests/
└── install/
    ├── unit/                 # Shell script unit tests
    │   ├── detect-platform.test.sh
    │   ├── verify-prereqs.test.sh
    │   └── download-release.test.sh
    └── integration/          # Docker-based integration tests
        ├── test-ubuntu.sh
        ├── test-macos.sh
        └── test-wsl.sh

.github/
└── workflows/
    └── test-installer.yml    # CI for testing install script
```

**Structure Decision**: Single project with install script at repository root. Shell scripts in `scripts/install/` for modularity and testability. Tests follow same structure as main codebase (unit + integration).

## Complexity Tracking

> No violations - all constitution principles pass.

## Phase 0: Research & Technical Decisions

### Research Tasks

**No research agents needed** - curl-based installation is well-established with clear patterns:

1. **Install Script Patterns**: Follow rustup/nvm model
   - Platform detection via `uname -s` and `uname -m`
   - Prerequisite checking with clear error messages
   - Download from GitHub Releases
   - Checksum verification (SHA256)
   - Atomic installation (download to temp, verify, move)

2. **PATH Management**: Standard shell profile updates
   - Detect shell (bash/zsh) via `$SHELL`
   - Update `~/.bashrc` or `~/.zshrc`
   - Source profile or instruct user to restart shell

3. **Version Management**: GitHub Releases API
   - Latest: `https://api.github.com/repos/mt-osiris-tools/mt-prism/releases/latest`
   - Specific: `https://api.github.com/repos/mt-osiris-tools/mt-prism/releases/tags/v1.2.3`
   - Download tarball asset, extract to install directory

4. **Error Handling**: Fail-fast with actionable messages
   - Check prerequisites before modifying system
   - Use trap to clean up on errors
   - Rollback on partial failures

### Technical Decisions

All decisions documented in research.md (creating next).

## Phase 1: Data Model & API Contracts

### Data Model

**Installation Manifest** (`~/.mt-prism/install.json`):
- version: Installed MT-PRISM version
- install_path: Where MT-PRISM is installed
- installed_at: ISO8601 timestamp
- node_version: Node.js version used
- platform: OS and architecture

### API Contracts

**Install Script Interface** (command-line options):

```bash
# Default (latest)
curl -fsSL https://install.mt-prism.dev | sh

# Specific version
curl -fsSL https://install.mt-prism.dev | sh -s -- --version 1.2.3

# Custom prefix
curl -fsSL https://install.mt-prism.dev | sh -s -- --prefix /usr/local

# Uninstall
curl -fsSL https://install.mt-prism.dev | sh -s -- --uninstall

# Help
curl -fsSL https://install.mt-prism.dev | sh -s -- --help
```

**Exit Codes**:
- 0: Success
- 1: General error
- 2: Prerequisites not met
- 3: Download failed
- 4: Verification failed
- 5: Installation failed

## Implementation Phases

*Note: /speckit.plan stops here. Run /speckit.tasks to generate task breakdown.*

Phase 2 (Task Breakdown) will be generated by `/speckit.tasks` command.
